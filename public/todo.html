 await fetch(`${PROXY_BASE}/proxy/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ clientCode: jobNumber.split(' ')[0], jobNumber, message })
                });
                
                if (res.ok) {
                    btn.textContent = 'âœ“ DONE';
                    btn.classList.add('success');
                    input.value = '';
                    card.querySelector('.job-update-preview').textContent = message;
                    setTimeout(() => { btn.textContent = 'UPDATE'; btn.classList.remove('success'); btn.disabled = false; }, 2000);
                } else throw new Error();
            } catch (e) {
                btn.textContent = 'ERROR';
                setTimeout(() => { btn.textContent = 'UPDATE'; btn.disabled = false; }, 2000);
            }
        }

        async function updateJobField(jobNumber, field, value) {
            console.log('Update', jobNumber, field, value);
            // TODO: API call
        }

        async function loadClients() {
            try {
                const res = await fetch(`${API_BASE}/clients`);
                if (res.ok) { clients = await res.json(); populateClientDropdown(); }
            } catch (e) {
                clients = [{code:'SKY',name:'Sky TV'},{code:'ONE',name:'One NZ'},{code:'HUN',name:'Hunch'},{code:'FIS',name:'Fisher Funds'},{code:'TOW',name:'Tower Insurance'}];
                populateClientDropdown();
            }
        }

        function populateClientDropdown() {
            const sel = document.getElementById('client-filter');
            sel.innerHTML = '<option value="all">All Clients</option>';
            clients.forEach(c => { const o = document.createElement('option'); o.value = c.code; o.textContent = c.name; sel.appendChild(o); });
        }

        async function loadJobs() {
            try {
                const res = await fetch(`${API_BASE}/jobs/all`);
                if (res.ok) { allJobs = await res.json(); render(); return; }
            } catch (e) { console.log('Using sample data'); }
            
            allJobs = [
                {jobNumber:'SKY 017',jobName:'Faulty Swap/Upgrade',clientCode:'SKY',description:'Refresh the Faulty/Swap email journey',projectOwner:'Mikaila Chen',update:'Copy feedback with us',updateDue:'2026-01-09',liveDate:'2026-01-15',lastUpdated:'2026-01-06',stage:'Refine',status:'In Progress',withClient:false,channelUrl:'https://teams.microsoft.com'},
                {jobNumber:'SKY 018',jobName:'Offboarding Journey',clientCode:'SKY',description:'Customer offboarding sequence',projectOwner:'Mikaila Chen',update:'With Mikaila for feedback',updateDue:'2026-01-07',liveDate:'2026-01-20',lastUpdated:'2025-12-31',stage:'Simplify',status:'In Progress',withClient:true,channelUrl:'https://teams.microsoft.com'},
                {jobNumber:'HUN 057',jobName:'Hunch Fix for 26',clientCode:'HUN',description:'Develop Dot World',projectOwner:'Michael Goldthorpe',update:'Debugging in progress',updateDue:'2026-01-13',liveDate:'2026-01-31',lastUpdated:'2026-01-05',stage:'Craft',status:'In Progress',withClient:false,channelUrl:'https://teams.microsoft.com'},
                {jobNumber:'HUN 056',jobName:'Grrow Logo',clientCode:'HUN',description:'Simple logo for Grrow',projectOwner:'Michael Goldthorpe',update:'Review and feedback on logos',updateDue:'2026-01-08',liveDate:'2026-01-05',lastUpdated:'2025-12-31',stage:'Refine',status:'In Progress',withClient:true,channelUrl:'https://teams.microsoft.com'},
                {jobNumber:'ONE 090',jobName:'April Price Increase',clientCode:'ONE',description:'Price increase communications',projectOwner:'Sarah Chen',update:'Feedback from Jess/Anita',updateDue:'2026-01-20',liveDate:'2026-04-01',lastUpdated:'2026-01-01',stage:'Refine',status:'In Progress',withClient:false,channelUrl:'https://teams.microsoft.com'},
                {jobNumber:'FIS 022',jobName:'Nest Evolution',clientCode:'FIS',description:'Initial brief received',projectOwner:'Jade Jordan',update:'Initial brief received',updateDue:null,liveDate:null,lastUpdated:'2026-01-07',stage:'Triage',status:'Incoming',withClient:false,channelUrl:'https://teams.microsoft.com'},
                {jobNumber:'TOW 087',jobName:'8-Month Health Check',clientCode:'TOW',description:'Know your numbers',projectOwner:'Paige Buckland',update:'Concept developed',updateDue:'2026-01-06',liveDate:'2026-02-02',lastUpdated:'2026-01-06',stage:'Simplify',status:'In Progress',withClient:false,channelUrl:'https://teams.microsoft.com'},
                {jobNumber:'SKY 010',jobName:'Level Up',clientCode:'SKY',description:'Sky Level Up programme',projectOwner:'Glennis Chan',update:'With Sky for next steps',updateDue:'2026-01-23',liveDate:null,lastUpdated:'2025-12-31',stage:'Simplify',status:'On Hold',withClient:true,channelUrl:'https://teams.microsoft.com'}
            ];
            render();
        }

        document.addEventListener('DOMContentLoaded', async () => { await loadClients(); await loadJobs(); });
    </script>
</body>
</html>
